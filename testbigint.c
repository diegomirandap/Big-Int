// Diego Miranda 2210996 3WA
// Felipe Cancella 2210487 3WA

#include <stdio.h>
#include "bigint.h"

int test_igual(BigInt a, BigInt b, char* msg, int test)
{
    int i;
    int deu_erro = 0;

    for (i = 0; i < 16; i++)
        if (a[i] != b[i]) deu_erro = 1;

    if (deu_erro)
        printf("Erro em %s no teste %d\n", msg, test);

    return deu_erro;
}

int test_big_val(char* msg)
{
  //Caso 1: 1
  //Caso 2: -2
  //Caso 3: 0
  //Caso 4: 9223372036854775807 (maior long)

  int falhas = 0;
  BigInt gab1 = { 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  BigInt res;
  big_val(res, 1);

  if (test_igual(res, gab1, msg, 1)) falhas += 1;

  BigInt gab2 = { 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF };
  big_val(res, -2);

  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  BigInt gab3 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  big_val(res, 0);

  if (test_igual(res, gab3, msg, 3)) falhas += 1;

  BigInt gab4 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  big_val(res, 9223372036854775807);

  if (test_igual(res, gab4, msg, 4)) falhas += 1;
  
  return (falhas != 0);
}

int test_big_comp2(char* msg)
{
  //Caso 1: 1 -> -1
  //Caso 2: -2 -> 2
  //Caso 3: 0 -> 0
  //Caso 4: -9223372036854775807 -> 9223372036854775807 

  int falhas = 0;
  BigInt gab1 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF };
  BigInt res, res2;
  big_val(res2, 1);
  big_comp2(res, res2);
  //Complemento a dois de 1
  if (test_igual(res, gab1, msg, 1)) falhas += 1;

  BigInt gab2 = { 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  big_val(res2, -2);
  big_comp2(res, res2);
  //Complemento a dois de -2
  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  BigInt gab3 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  big_val(res2, 0);
  big_comp2(res, res2);
  //Complemento a dois de 0

  if (test_igual(res, gab3, msg, 3)) falhas += 1;

  BigInt gab4 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  big_val(res2, -9223372036854775807 );
  big_comp2(res, res2);
  //Complemento a dois de 9223372036854775807 

  if (test_igual(res, gab4, msg, 4)) falhas += 1;

  return (falhas != 0);
}

int test_big_sum(char* msg)
{
  //Caso 1: 1  + 1
  //Caso 2: -2 + 1
  //Caso 3: -2 + -2
  //Caso 4: 9223372036854775807 + 1 (Primeiro valor exclusivo de BigInt)

  int falhas = 0;
  BigInt Valor1 = { 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //1
  BigInt Valor2 = { 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-2
  BigInt Valor3 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //9223372036854775807 (maior long)


  BigInt gab1 = { 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //2
  BigInt res;
  big_sum(res, Valor1, Valor1);

  if (test_igual(res, gab1, msg, 1)) falhas += 1;


  BigInt gab2 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-1
  big_sum(res, Valor2, Valor1);

  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  BigInt gab3 = { 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-4
  big_sum(res, Valor2, Valor2);

  if (test_igual(res, gab3, msg, 3)) falhas += 1;

  BigInt gab4 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //9223372036854775808
  big_sum(res, Valor3, Valor1);

  if (test_igual(res, gab4, msg, 4)) falhas += 1;

  return (falhas != 0);
}

int test_big_sub(char* msg)
{

  //Caso 1: pos-pos             1 - 1  = 0
  //Caso 2: neg-pos            -2 - 1  = -3
  //Caso 3: neg-neg            -2 - -2 = 0
  //Caso 4: pos - pos          9223372036854775808 - 1 = 9223372036854775807

  int falhas = 0;
  BigInt Valor1 = { 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //1
  BigInt Valor2 = { 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-2
  BigInt Valor3 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //9223372036854775808 (primeiro BigInt exclusivo long)


  BigInt gab1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //0
  BigInt res;
  big_sub(res, Valor1, Valor1);

  if (test_igual(res, gab1, msg, 1)) falhas += 1;


  BigInt gab2 = { 0xFD, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-3
  big_sub(res, Valor2, Valor1);

  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  BigInt gab3 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //0
  big_sub(res, Valor2, Valor2);

  if (test_igual(res, gab3, msg, 3)) falhas += 1;

  BigInt gab4 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //9223372036854775807
  big_sub(res, Valor3, Valor1);

  if (test_igual(res, gab4, msg, 4)) falhas += 1;


  return (falhas != 0);
}

int test_big_mul(char* msg)
{
  //Caso 1: pos*pos     4 * 9223372036854775808 = 36893488147419103232
  //Caso 2: neg*pos    -2 * 9223372036854775808 = -18446744073709551616
  //Caso 3: neg*neg    -2 * -2 = 4
  //Caso 4: neg*0     

  int falhas = 0;
  BigInt Valor1 = { 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //4
  BigInt Valor2 = { 0xFE, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-2
  BigInt Valor3 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //9223372036854775808
  BigInt Valor4 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //0

  BigInt res;

  BigInt gab1 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //36893488147419103232
  big_mul(res, Valor1, Valor3);

  if (test_igual(res, gab1, msg, 1)) falhas += 1;

  BigInt gab2 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF }; //-18446744073709551616

  big_mul(res, Valor2, Valor3);

  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  BigInt gab3 = { 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //4
  big_mul(res, Valor2, Valor2);

  if (test_igual(res, gab3, msg, 3)) falhas += 1;

  BigInt gab4 = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }; //0
  big_mul(res, Valor2, Valor4);

  if (test_igual(res, gab4, msg, 4)) falhas += 1;

  return (falhas != 0);
}

int test_big_shl(char* msg)
{
  //Caso 1: 116193<<11=237963264
  //Caso 2: -2<<1=-4

  int falhas = 0;

  BigInt gab1 = { 0x00, 0x08, 0x2F, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  BigInt res, res2;
  big_val(res2, 116193);
  big_shl(res, res2, 11);
  //Shift a esquerda em 11 unidades de 116193
  if (test_igual(res, gab1, msg, 1)) falhas += 1;

  BigInt gab2 = { 0xFC, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF };
  big_val(res2, -2);
  big_shl(res, res2, 1);
  //Shift a esquerda em 1 unidade de -2
  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  return (falhas != 0);
}

int test_big_shr(char* msg)
{
  //Caso 1: 237963264>>5=116193 (logico)
  //Caso 2: -2>>10 (logico)

  int falhas = 0;

  BigInt gab1 = { 0x40, 0x78, 0x71, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  BigInt res, res2;
  big_val(res2, 237963264);
  big_shr(res, res2, 5);
  //Shift logico a direita em 5 unidades de 237963264
  if (test_igual(res, gab1, msg, 1)) falhas += 1;

  BigInt gab2 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x3F, 0x00 };
  big_val(res2, -2);
  big_shr(res, res2, 10);
  //Shift a direita em 10 unidade de -2
  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  return (falhas != 0);
}

int test_big_sar(char* msg)
{
  //Caso 1: 237963264>>5=116193 (aritimetico)
  //Caso 2: -2>>10 (aritimetico)
  int falhas = 0;

  BigInt gab1 = { 0x40, 0x78, 0x71, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };
  BigInt res, res2;
  big_val(res2, 237963264);
  big_sar(res, res2, 5);
  //Shift logico a direita em 5 unidades de 237963264
  if (test_igual(res, gab1, msg, 1)) falhas += 1;

  BigInt gab2 = { 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF };
  big_val(res2, -2);
  big_sar(res, res2, 10);
  //Shift a direita em 10 unidade de -2
  if (test_igual(res, gab2, msg, 2)) falhas += 1;

  return (falhas != 0);
}

int main()
{
  int falhas = 0;

  falhas += test_big_val("big_val");
  falhas += test_big_comp2("big_comp2");
  falhas += test_big_sum("big_sum");
  falhas += test_big_sub("big_sub");
  falhas += test_big_mul("big_mul");
  falhas += test_big_shl("big_shl");
  falhas += test_big_shr("big_shr");
  falhas += test_big_sar("big_sar");

  printf("Total de falhas %d de 8\n", falhas);
  return 0;
}
